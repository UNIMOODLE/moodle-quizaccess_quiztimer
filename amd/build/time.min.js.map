{"version":3,"file":"time.min.js","sources":["../src/time.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, ajax, notification, str) {\n\n    const urlparams = new URLSearchParams(window.location.search);\n    const cmid = urlparams.get('cmid');\n\n    const selectstrings = str.get_strings([{key: 'sectiontime', component: 'quizaccess_quiztimer'},\n                                             {key: 'questiontime', component: 'quizaccess_quiztimer'},\n                                             {key: 'distributesectiontime', component: 'quizaccess_quiztimer'}, ]);\n    const unitsstrings = str.get_strings([{key: 'seconds', component: 'quizaccess_quiztimer'},\n                                             {key: 'minutes', component: 'quizaccess_quiztimer'},\n                                             {key: 'hours', component: 'quizaccess_quiztimer'},]);\n    /**\n     * When a key is pressed, editing a question time,\n     * checks what it should do, and displays the question\n     * edit, removing the input of time edit.\n     * If necesary, inserts the time of the question in the db.\n     *\n     * @param {event} e\n     */\n    const questiontime = async function(e) {\n        const invalidsettedtime = await str.get_string('invalidsettedtime', 'quizaccess_quiztimer');\n        target = e.currentTarget;\n        if (e.key === 'Enter') {\n            timevalue = target.value\n            target.value = timevalue.replace(/[^0-9].*$/,'');\n            timevalue = target.value\n            timedisplay = target.closest('.time').querySelector('.question-time')\n            if(timevalue == '') {\n                notification.addNotification({\n                    message: invalidsettedtime,\n                    type: \"error\"\n                 });\n                window.scrollTo({ top: 0, behavior: 'smooth' })\n            } else if (timevalue == 0) {\n                notification.addNotification({\n                    message: invalidsettedtime,\n                    type: \"error\"\n                 });\n                window.scrollTo({ top: 0, behavior: 'smooth' })\n            } else {\n                timedisplay.innerHTML = timevalue\n            }\n            timedisplay.removeAttribute('style')\n\n            timeid = timedisplay.getAttribute('id') + '-edit';\n            $('#' + timeid).remove();\n            set_question_time_call(timedisplay);\n            let timetype = document.querySelector('input[name=\"timetype\"]')\n            display_quiz_time(timetype.value);\n\n        } else if (e.key === 'Escape') {\n            timedisplay = target.closest('.time').querySelector('.question-time')\n            timedisplay.removeAttribute('style')\n            this.remove()\n        }\n    }\n\n    /**\n     * When a key is pressed, editing a section time,\n     * checks what it should do, and displays the section\n     * edit, removing the input of time edit.\n     * If necesary, inserts the time of the section in the db.\n     *\n     * @param {event} e\n     */\n    const sectiontime = async function(e) {\n        const invalidsettedtime = await str.get_string('invalidsettedtime', 'quizaccess_quiztimer');\n        target = e.currentTarget;\n        if (e.key === 'Enter') {\n            target.value = target.value.replace(/[^0-9].*$/,'');\n            timevalue = target.value\n            timedisplay = target.closest('.section-heading').querySelector('.section-time')\n            timedisplay.innerHTML = timevalue\n            if(timevalue == '') {\n                timedisplay.innerHTML = 0;\n                notification.addNotification({\n                    message: invalidsettedtime,\n                    type: \"error\"\n                 });\n                window.scrollTo({ top: 0, behavior: 'smooth' })\n            } else if (timevalue == 0) {\n                notification.addNotification({\n                    message: invalidsettedtime,\n                    type: \"error\"\n                 });\n                window.scrollTo({ top: 0, behavior: 'smooth' })\n            }\n            timedisplay.removeAttribute('style')\n            timeid = timedisplay.getAttribute('id') + '-edit';\n            $('#' + timeid).remove();\n            timedata = get_section_time_from_slots(timedisplay.closest('.section-heading'));\n            set_section_time_call(timedisplay.closest('.section.main.clearfix'),\n                parseFloat(timedata.unit), parseFloat(timedata.value));\n            let timetype = document.querySelector('input[name=\"timetype\"]')\n            display_quiz_time(timetype.value);\n\n        } else if (e.key === 'Escape') {\n            timedisplay = target.closest('.section-heading').querySelector('.section-time')\n            timedisplay.removeAttribute('style')\n            this.remove()\n        }\n    }\n\n    /**\n     * Adjust the question time to display, when a new\n     * unit time is selected, checking beforehand if\n     * the unit is valid.\n     *\n     * @param {event} e\n     */\n    const adjust_question_time_display = function (e) {\n        selectedoption = e.currentTarget;\n        value = selectedoption.value;\n        timedata = get_question_time(selectedoption.closest('.slot'));\n        let value = parseFloat(timedata.value);\n        if (timedata.value !== '0' && !isNaN(timedata.value)) {\n            selectedoption.options[0].setAttribute('disabled', 'true');\n            set_question_time_call(selectedoption);\n            let timetype = document.querySelector('input[name=\"timetype\"]')\n            display_quiz_time(timetype.value);\n        }\n    }\n\n    /**\n     * Adjust the section time to display, when a new\n     * unit time is selected, checking beforehand if\n     * the unit is valid.\n     *\n     * @param {event} e\n     */\n    const adjust_section_time_display = function (e) {\n        selectedoption = e.currentTarget;\n        section = selectedoption.closest('.section.main.clearfix');\n        unit = selectedoption.value;\n        value = parseFloat(section.querySelector('.section-time').innerHTML);\n        if ((value !== 0 && !isNaN(value)) && (unit !== '0' && !isNaN(unit))) {\n            selectedoption.options[0].setAttribute('disabled', 'true');\n            unit = parseFloat(section.querySelector('.time-select').options[unit].value);\n            value = parseFloat(section.querySelector('.section-time').innerHTML);\n            set_section_time_call(section, unit, value);\n            let timetype = document.querySelector('input[name=\"timetype\"]')\n            display_quiz_time(timetype.value);\n        }\n    }\n\n    /**\n     * Gets a question time from the page inputs.\n     *\n     * @param {event} question.\n     * @returns JSON string containing the question time.\n     */\n        const get_question_time = function(question) {\n            unit = question.querySelector('.time-select').value\n            timevalue = question.querySelector('.question-time').innerHTML\n            timevalue = get_time_in_seconds(parseFloat(unit), parseFloat(timevalue));\n            return {'unit' : unit, 'value' : timevalue};\n        }\n\n    /**\n     * Gets a section time from the slots time.\n     *\n     * @param {event} section\n     * @returns JSON string containing the secton time.\n     */\n    const get_section_time_from_slots = function(section) {\n        unit = section.querySelector('.time-select').value\n        timevalue = section.querySelector('.section-time').innerHTML\n        return { 'unit' : unit ,'value' : timevalue}\n    }\n\n    /**\n     * Gets the id of a section.\n     *\n     * @param {htmlElement} section\n     * @returns JSON string with the section id\n     */\n    const get_section_id = function(section) {\n        id = section.id\n        sectionid = id.substring(id.indexOf('-') + 1);\n        return { 'sectionid':sectionid}\n    }\n    /**\n     * Gets the id of a question\n     *\n     * @param {htmlElement} question\n     * @returns JSON string containing the numeric part of the question id.\n     */\n    const get_question_id = function(question) {\n        id = question.id\n        slotid = id.substring(id.indexOf('-') + 1);\n        return { 'questionid':slotid}\n    }\n\n    /**\n     * When the edit question event is triggered,\n     * creates a input for editing the time, and hides\n     * the display time.\n     * Also assigns events when a key is pressed on the newly\n     * created input, aswell as a blur event.\n     *\n     * @param {event} e\n     */\n    const edit_question_time = function(e) {\n        time = e.currentTarget.closest('.time')\n        timevalue = time.querySelector('.question-time')\n        timeid = timevalue.getAttribute('id') + '-edit';\n        $('<input></input>')\n            .attr({\n                'type': 'text',\n                'name': 'time',\n                'id': timeid,\n                'size': '5',\n                'value': timevalue.innerHTML\n            })\n            .prependTo(time);\n        timevalue.setAttribute('style', 'display:none')\n        $('#' + timeid).focus();\n        $('#' + timeid).on('keydown', this, questiontime)\n        $('#' + timeid).on('blur', this, function() {\n            this.closest('.time').querySelector('.question-time').removeAttribute('style')\n            this.remove();\n        })\n\n    }\n    /**\n     * When the edit section event is triggered,\n     * creates a input for editing the time, and hides\n     * the display time.\n     * Also assigns events when a key is pressed on the newly\n     * created input, aswell as a blur event.\n     *\n     * @param {event} e\n     */\n    const edit_section_time = function(e) {\n        time = e.currentTarget.closest('.time')\n        timevalue = time.querySelector('.section-time')\n        timeid = timevalue.getAttribute('id') + '-edit'\n        $('<input></input>')\n            .attr({\n                'type': 'text',\n                'name': 'time',\n                'id': timeid,\n                'size': '5',\n                'value': timevalue.innerHTML,\n            })\n            .prependTo(time);\n        timevalue.setAttribute('style', 'display:none')\n        $('#' + timeid).focus();\n        $('#' + timeid).on('keydown', this, sectiontime)\n        $('#' + timeid).on('blur', this, function() {\n            this.closest('.section-heading').querySelector('.section-time').removeAttribute('style')\n            this.remove();\n\n        })\n    }\n\n    /**\n     * Triggered at changing the edit format used,\n     * sets a new url based on the option picked,\n     * then it redirects the user to the new url.\n     *\n     * @param {event} e\n     */\n    const change_time_edit_method = function(e) {\n        editmethod = e.currentTarget.value;\n        let url = location.href;\n        let k = url.search('&edittype=');\n        if (k != -1) {\n            let param = url.substring(k);\n            let editmethod2 = param.split('=')[1]\n            url = url.replace(editmethod2, editmethod);\n        } else {\n            url += '&edittype=' + editmethod;\n        }\n        url = url.replace('#', '');\n        get_quiz_id(cmid).then( response => {\n            quizid = JSON.parse(response).quizid;\n            repaginate_slots(quizid,editmethod).then(r => {\n                window.location.href = url;\n            });\n        });\n\n    }\n\n    /**\n     * Loads a section time based on the questions times\n     * of the section, and their unit selected.\n     *\n     * @param {htmlElement} section\n     *\n     */\n    const load_section_time = (section) => {\n        questions = section.querySelectorAll('.slot')\n        totaltime = get_total_time_of_questions(questions);\n        sectiontimeunit = parseFloat(section.querySelector('.time-select').value);\n        totaltime = (get_time_in_unit(sectiontimeunit, totaltime));\n        section.querySelector('.total-section-time').innerHTML = totaltime;\n        if (parseFloat(section.querySelector('.time-select').value) === 0) {\n            section.querySelector('.total-section-unit').value = 1;\n        }\n        sectiontimeunit = section.querySelector('.time-select').options[sectiontimeunit].innerHTML;\n        section.querySelector('.total-section-unit').innerHTML = sectiontimeunit;\n    }\n\n    const repaginate_slots = (quizid, editmethod) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_repaginate_slots',\n        args: {\n            quizid,\n            editmethod,\n        },\n    }])[0].done( response => {\n        return response;\n    }).fail( err => {\n        console.log(err);\n    });\n\n    /**\n     * Sets a section time with an ajax call, saving the time\n     * information on the sections db.\n     *\n     * @param {htmlElement} section\n     * @param {int} unit\n     * @param {int} value\n     */\n    const set_section_time_call = (section, unit, value) => {\n        questions = section.querySelectorAll('.slot');\n        value = get_time_in_seconds(unit, value);\n        timedata = {'unit' : unit, 'value' : value};\n            get_quiz_id(cmid).then( response => {\n                quizid = JSON.parse(response).quizid;\n                let sectionid = get_section_id(section).sectionid;\n                set_section_time(quizid, sectionid, timedata).then(response => {\n                    get_section_time_call(section);\n                })\n        });\n    }\n\n    /**\n     * Gets a section time from the db\n     * if the section dont have a time, sets it\n     * visually to 0 and no unit, without inserting in db.\n     *\n     * @param {htmlElement} section\n     */\n    const get_section_time_call = async (section) => {\n        const warningtimestr = await str.get_string('warningtime', 'quizaccess_quiztimer');\n        get_quiz_id(cmid).then( response => {\n            let quizid = JSON.parse(response).quizid;\n            let sectionid = get_section_id(section).sectionid;\n            get_section_time(quizid, sectionid).then(response => {\n                timedata = JSON.parse(response);\n                console.log('time', timedata, section);\n                if(!timedata) {\n                section.querySelector('.time-select').value = 2;\n                section.querySelector('.total-section-time').innerHTML = '';\n                section.querySelector('.total-section-unit').innerHTML = '';\n                section.querySelector('.section-time').innerHTML = 0;\n                }\n                unit = timedata.timeunit;\n                value = get_time_in_unit(parseFloat(unit), parseFloat(timedata.timevalue));\n                if (value === 0) {\n                    section.querySelector('.time-select').value = 2;\n                    if (!section.querySelector('.warningtime')) {\n                        let warningtime = document.createElement('span');\n                        warningtime.setAttribute('class', 'text-danger warningtime')\n                        warningtime.append(warningtimestr);\n                        section.querySelector('.section-heading').appendChild(warningtime);\n                    }\n                } else {\n                    section.querySelector('.time-select').value = unit;\n                    if (section.querySelector('.warningtime')) {\n                        section.querySelector('.section-heading').removeChild(section.querySelector('.warningtime'));\n                    }\n                }\n                section.querySelector('.total-section-time').innerHTML = value;\n                section.querySelector('.total-section-unit').innerHTML = section.querySelector('.time-select').options[unit].text;\n                section.querySelector('.section-time').innerHTML = value;\n            });\n        });\n    }\n\n    /**\n     * Gets the total amount of time of the selected questions\n     * and returns it in seconds.\n     *\n     * @param {array} questions\n     * @returns int total questions time in seconds.\n     */\n    const get_total_time_of_questions = (questions) => {\n        totaltime = 0;\n        for(let t = 0; t < questions.length; t ++) {\n            timeunit = parseInt(questions[t].querySelector('.time-select').value);\n            time = parseFloat(questions[t].querySelector('.question-time').innerHTML);\n            timeinseconds = get_time_in_seconds(timeunit, time);\n            totaltime += timeinseconds;\n        }\n        return totaltime;\n    }\n\n\n    /**\n     * Given a page, if it exist, updates the displayed time\n     * else creates the page elements for time control.\n     *\n     * @param {htmlElement} page\n     */\n    const load_page_time = (page) => {\n\n        if (pagetime = page.querySelector('.pagetime')) {\n            let time = pagetime.querySelector('.total-page-time');\n            let unit = pagetime.querySelector('.total-page-unit');\n            id = page.getAttribute('id');\n            let question = $(page).nextUntil('.pagenumber.activity.timed')\n            totaltime = get_total_time_of_questions(question);\n            pagetimeunit = parseFloat(question[0].querySelector('.time-select').value);\n            totaltime = (get_time_in_unit(pagetimeunit, totaltime));\n            time.innerHTML = totaltime;\n            unit.innerHTML = question[0].querySelector('.time-select').options[pagetimeunit].innerHTML;\n        } else {\n            create_timed_page_elements(page);\n        }\n    }\n\n    /**\n     * Generates all the html elements to edit a page time[TODO],\n     * the time of the page, based on the containing slot,\n     * aswell as assign them the properties to modify the time.\n     *\n     * @param {htmlElement} page\n     */\n    const create_timed_page_elements = (page) => {\n        id = page.getAttribute('id');\n        let question = $('#' + id).nextUntil('.pagenumber.activity.timed')\n        totaltime = get_total_time_of_questions(question);\n        pagetimeunit = parseFloat(question[0].querySelector('.time-select').value);\n        totaltime = (get_time_in_unit(pagetimeunit, totaltime));\n        let pagetime = document.createElement('span')\n        pagetime.setAttribute('class', 'pagetime')\n        page.append(pagetime);\n\n        let pagevalue = document.createElement('span')\n        pagevalue.setAttribute('class', 'total-page-time')\n        pagevalue.innerHTML = totaltime\n        pagetime.append(pagevalue)\n\n        let pageunit = document.createElement('span')\n        pageunit.setAttribute('class', 'total-page-unit')\n        pageunit.innerHTML = question[0].querySelector('.time-select').options[pagetimeunit].innerHTML;\n        pagetime.append(' ');\n        pagetime.append(pageunit);\n    }\n\n    /**\n     * Loads tbe page time\n     *\n     * @param {htmlElement} page\n     */\n    var pageloadedsections = [];\n    const get_page_time_from_section = (page) => {\n        let section = page.closest('.section.main.clearfix');\n        if (!pageloadedsections.includes(section.id)) {\n            pageloadedsections.push(section.id);\n            let sectionpages = section.querySelectorAll('.pagenumber');\n            let sectionid = get_section_id(section).sectionid;\n            get_quiz_id(cmid).then( response => {\n                let quizid = JSON.parse(response).quizid;\n                get_section_time(quizid, sectionid).then( response => {\n                        let totalsectime = JSON.parse(response).timevalue;\n                        let pagetime = totalsectime / sectionpages.length;\n                        $.when(unitsstrings).done( unitsstrings => {\n                            pagetime = format_pagetime(pagetime, unitsstrings[0], unitsstrings[1], unitsstrings[2]);\n                            for (let t = 0; t < sectionpages.length; t ++) {\n                                sectionpages[t].querySelector('.total-page-time').innerHTML = pagetime;\n                            }\n                        });\n                });\n            });\n\n        }\n\n    }\n\n    /**\n     * Formats the time in seconds, and gets a\n     * string to display the units using moodle lang strings.\n     *\n     * @param {int} time\n     * @param {string} seconds\n     * @param {string} minutes\n     * @param {string} hours\n     * @returns {string} formatted time\n     */\n    const format_pagetime = (time, seconds, minutes, hours) => {\n        if (time / 3600 >= 1) {\n            let h = Math.floor(time / 3600);\n            if (time % 3600 !== 0) {\n                if (time % 3600 > 60) {\n                    if ((time % 3600) % 60 !== 0 ) {\n                        let m = Math.floor((time % 3600) / 60);\n                        let s = (time % 3600) % 60;\n                        pagetime = h + ' ' + hours + ' ' + m + ' ' + minutes + ' ' + s + ' ' + seconds;\n                        return pagetime;\n                    }\n                    let m = (time % 3600) / 60;\n                    pagetime = h + ' ' + hours + ' ' + m + ' ' + minutes;\n                    return pagetime;\n                }\n                let s = (time % 3600);\n                pagetime = h + ' ' + hours + ' ' + s + ' ' + seconds;\n                return pagetime;\n            }\n            pagetime = h + ' ' + hours;\n            return pagetime;\n        } else if (time / 60 >= 1) {\n            let m = Math.floor(time / 60);\n            if (time % 60 !== 0) {\n                let s = +(time % 60).toFixed(2);\n                pagetime = m + ' ' + minutes + ' ' + s + ' ' + seconds;\n                return pagetime;\n            }\n            pagetime = m + ' ' + minutes;\n            return pagetime;\n        } else {\n            pagetime = +time.toFixed(2) + ' ' + seconds;\n            return pagetime;\n        }\n    }\n\n    /**\n     * Gets the time to set in seconds for the insert\n     * in the database.\n     *\n     * @param {int} timeunit\n     * @param {int} time\n     * @returns the time to insert in the database.\n     */\n    const get_time_in_seconds = (timeunit, time) => {\n        switch (timeunit) {\n            case 1:\n                timeinseconds = time;\n                break;\n            case 2:\n                timeinseconds = time * 60;\n                break;\n            case 3:\n                timeinseconds = time * 3600;\n                break\n            default:\n                timeinseconds = 0;\n                break;\n\n        }\n        return timeinseconds;\n    }\n\n    /**\n     * Gets the time in the unit requested\n     * to show.\n     *\n     * @param {int} timeunit\n     * @param {int} time\n     * @returns the time in the selected unit.\n     */\n    const get_time_in_unit = (timeunit, time) => {\n        switch (timeunit) {\n            case 1:\n                sectiontimeinunit = time;\n                break;\n            case 2:\n                sectiontimeinunit = time / 60;\n                break;\n            case 3:\n                sectiontimeinunit = time / 3600;\n                break\n            default:\n                sectiontimeinunit = 0;\n                break;\n\n        }\n        return parseFloat(sectiontimeinunit.toFixed(2));\n    }\n\n    /**\n     * Displays and updates the total quiz time.\n     *\n     * @param {string} timetype\n     */\n    const display_quiz_time = (timetype) => {\n        let quiztimer = document.querySelector('.quiztimer-time');\n        $.when(unitsstrings).done( unitsstrings => {\n            get_quiz_id(cmid).then( response => {\n                quizid = JSON.parse(response).quizid;\n                get_quiz_time(quizid, timetype).then( r => {\n                    let time = format_pagetime(JSON.parse(r).time,unitsstrings[0], unitsstrings[1], unitsstrings[2]);\n                    quiztimer.innerHTML == '' ? quiztimer.append(' | ' + time) :\n                    quiztimer.innerHTML = ' | ' + time;\n                });\n            });\n        });\n\n    }\n\n    /**\n     * Returns the quiz time.\n     *\n     * @param {int} quizid\n     * @param {string} editmethod\n     * @returns\n     */\n    const get_quiz_time = (quizid, editmethod) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_get_quiz_time',\n        args: {\n            quizid,\n            editmethod,\n        },\n    }])[0].done( response => {\n        return response;\n    }).fail( err => {\n        console.log(err);\n    });\n\n    /**\n     * Sets a section time with an ajax call, updating or inserting\n     * the section with the new timedata.\n     *\n     * @param {int} quizid\n     * @param {int} sectionid\n     * @param {JSON} timedata\n     * @returns JSON string with the modified section data in db.\n     */\n    const set_section_time = (quizid, sectionid, timedata) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_set_section_time',\n        args: {\n            quizid,\n            sectionid,\n            timedata: JSON.stringify(timedata),\n        },\n    }])[0].done( response => {\n        return response;\n    }).fail( err => {\n        console.log(err);\n    });\n\n    /**\n     * Gets a section time info\n     * with an ajax call to the sections time db.\n     *\n     * @param {int} quizid\n     * @param {int} sectionid\n     * @returns JSON string with the section time.\n     */\n    const get_section_time = (quizid, sectionid) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_get_section_time',\n        args: {\n            quizid,\n            sectionid,\n        },\n    }])[0].done( response => {\n        return response;\n    }).fail( err => {\n        console.log(err);\n    });\n\n    /**\n     * Calls the ajax function to set a slot time and\n     * updates the page and section time display to reflect\n     * their time adjusted with the new question time set.\n     *\n     * @param {htmlElement} slot\n     * @returns JSON string with the modified slot info.\n     */\n    const set_question_time_call = (slot) => {\n        console.log(slot);\n        timedata = get_question_time(slot.closest('.slot'));\n            if (timedata.unit != 0) {\n                question = slot.closest('[id^=\"slot\"]');\n                questionid = get_question_id(question);\n                if (timedata.value != 0) {\n                    if (question.querySelector('.warningtime')) {\n                        question.querySelector('.activityinstance').removeChild(question.querySelector('.warningtime'));\n                    }\n                }\n                get_quiz_id(cmid).then( response => {\n                    quizid = JSON.parse(response);\n                    set_question_time(quizid.quizid, questionid.questionid, timedata).then(response => {\n                        page = get_page_from_slotid(JSON.parse(response).slot);\n                        load_page_time(page);\n                        load_section_time(question.closest('.section.main.clearfix'));\n                    })\n                });\n\n            }\n    }\n    /**\n     *\n     * @param {int} quizid\n     * @param {int} questionid\n     * @param {array} timedata\n     * @returns response with the modified slot information.\n     */\n    const set_question_time = (quizid, questionid, timedata) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_set_question_time',\n        args: {\n            quizid,\n            questionid,\n            timedata: JSON.stringify(timedata),\n        },\n    }])[0].done( response => {\n        return response;\n    }).fail( err => {\n        console.log(err);\n    });\n\n    /**\n     *\n     * @param {int} cmid\n     * @returns ajax response with the quizid\n     */\n    const get_quiz_id = (cmid) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_get_quiz_id',\n        args: {\n            cmid,\n        },\n    }])[0].done(function(response) {\n        return response;\n    }).fail(function(err) {\n        console.log(err);\n    });\n\n    /**\n     *\n     * @param {int} questionid\n     * @param {array} timedata\n     * @returns\n     */\n    const load_question_time = (questionid) => ajax.call([{\n        methodname: 'quizaccess_quiztimer_get_question_time',\n        args: {\n            questionid,\n        },\n    }])[0].done( response => {\n        return response;\n    }).fail( err => {\n        console.log(err);\n    });\n\n    /**\n     *\n     * @param {htmlElement} slot\n     * @returns the page the slot belongs to.\n     */\n    const get_page_from_slotid = (slot) => {\n        slotid = 'slot-' + slot;\n        page = ($('#' + slotid).prev('.pagenumber.timed')[0]);\n        return(page);\n    }\n\n    return {\n        init: async function(timetype = 'section') {\n            const warningtimestr = await str.get_string('warningtime', 'quizaccess_quiztimer');\n            $(document).ready(function() {\n                navitem = $('.activity-header')[0];\n\n                $.when(selectstrings).done( selectstrings => {\n                    let select = document.createElement('select');\n                    select.setAttribute('class', 'custom-select urlselect timeselect');\n                    select.setAttribute('id', 'id_quiztimer_quizmodeselector');\n                    select.add(new Option(selectstrings[0], 'section'));\n                    select.add(new Option(selectstrings[1], 'slots'));\n                    select.add(new Option(selectstrings[2], 'equitative'));\n                    navitem.append(select);\n                    if (select.options[0].value == timetype) {\n                        selectedoption = 0;\n                    } else if (select.options[1].value == timetype) {\n                        selectedoption = 1;\n                    } else {\n                        selectedoption = 2;\n                    }\n                    select.options[selectedoption].setAttribute('selected', 'true');\n                    select.addEventListener('change', change_time_edit_method, true);\n                })\n                let quiztime = document.createElement('span');\n                quiztime.setAttribute('class', 'quiztimer-time');\n                let slotheader = document.querySelector('.mod-quiz-edit-content').querySelector('h2');\n                slotheader.append(quiztime);\n                display_quiz_time(timetype);\n                let secrettimetype = document.createElement('input');\n                secrettimetype.setAttribute(\"type\", \"hidden\");\n                secrettimetype.setAttribute(\"name\", \"timetype\");\n                secrettimetype.setAttribute(\"value\", timetype);\n                slotheader.append(secrettimetype);\n\n                questions = $('.slot');\n                if (questions.length === 0) {\n                    section = $('.section.main.clearfix')[0];\n                    section.setAttribute('style', 'display:none');\n                    notification.addNotification({\n                       message: \"No se encontraron preguntas, comprueba que se han añadido correctamente al quiz.\",\n                       type: \"error\"\n                    });\n                    $('.slots')[0].append('Preguntas:0 | Este cuestionario está vacio');\n                    return;\n                }\n                pagesar = [];\n                for (let x = 0; x < questions.length; x ++) {\n                    let question = questions[x];\n                    let select = question.querySelector('.time-select')\n\n                    select.addEventListener('change', adjust_question_time_display, true);\n\n                    editpen = question.querySelector('.editing-question-time')\n                    editpen.addEventListener('click', edit_question_time, true)\n\n                    questionid = get_question_id(question);\n                    let timeinput = question.querySelector('.question-time');\n                    load_question_time(questionid.questionid).then(function (response) {\n                        if (timetype === 'section') {\n                            question.querySelector('.time').setAttribute('style', 'display:none');\n                            select.setAttribute('style', 'display:none');\n                        } else if (timetype === 'slots') {\n                            if (timedata = JSON.parse(response) || JSON.parse(response).timevalue == 0) {\n                                select.value = timedata.timeunit;\n                                timeinput.innerHTML = get_time_in_unit(parseFloat(timedata.timeunit), parseFloat(timedata.timevalue));\n                                if ((!question.querySelector('.warningtime') && timedata.timevalue == 0)) {\n                                    let warningtime = document.createElement('span');\n                                    warningtime.setAttribute('class', 'text-danger warningtime')\n                                    warningtime.append(warningtimestr);\n                                    question.querySelector('.activityinstance').appendChild(warningtime);\n                                }\n                            }  \n                            pages = $('.pagenumber.activity.timed')\n                            for (let t = 0; t < pages.length; t ++) {\n                                let page = pages[t];\n                                if (!pagesar.includes(page.id)) {\n                                    pagesar.push(page.id);\n                                }\n                                load_page_time(page);\n                            }\n                            let section = question.closest('.section.main.clearfix');\n                            section.querySelector('.time-select').options[2].setAttribute('selected', true);\n                            section.querySelector('.time-select').setAttribute('style', 'display:none');\n                            section.querySelector('.time').setAttribute('style', 'display:none');\n                            load_section_time(section);\n                            section.querySelector('.section-time').innerHTML = section.querySelector('.total-section-time').innerHTML\n                        } else if (timetype === 'equitative') {\n\n                            question.querySelector('.time').setAttribute('style', 'display:none');\n                            select.setAttribute('style', 'display:none');\n                            pages = $('.pagenumber.activity.timed')\n                            for (let t = 0; t < pages.length; t ++) {\n                                let page = pages[t];\n                                if (!pagesar.includes(page.id)) {\n                                    pagesar.push(page.id);\n                                    load_page_time(page, false);\n                                    get_page_time_from_section(page);\n                                }\n                            }\n                        }\n\n                    });\n\n                }\n                sections = $('.section.main.clearfix');\n                for (let x = 0; x < sections.length; x ++) {\n                    let section = sections[x];\n                    select = section.querySelector('.time-select')\n                    select.addEventListener('change', adjust_section_time_display, true);\n\n                    editpen = section.querySelector('.editing-section-time')\n                    editpen.addEventListener('click', edit_section_time, true)\n                    if (timetype !== 'slots') {\n                        get_section_time_call(section.closest('.section.main.clearfix'));\n                    }\n                }\n            });\n        },\n    };\n});\n"],"names":["define","$","ajax","notification","str","cmid","URLSearchParams","window","location","search","get","selectstrings","get_strings","key","component","unitsstrings","questiontime","async","e","invalidsettedtime","get_string","target","currentTarget","timevalue","value","replace","timedisplay","closest","querySelector","addNotification","message","type","scrollTo","top","behavior","innerHTML","removeAttribute","timeid","getAttribute","remove","set_question_time_call","timetype","document","display_quiz_time","sectiontime","timedata","get_section_time_from_slots","set_section_time_call","parseFloat","unit","adjust_question_time_display","selectedoption","get_question_time","isNaN","options","setAttribute","adjust_section_time_display","section","question","get_time_in_seconds","get_section_id","id","sectionid","substring","indexOf","get_question_id","slotid","edit_question_time","time","attr","prependTo","focus","on","this","edit_section_time","change_time_edit_method","editmethod","url","href","k","editmethod2","split","get_quiz_id","then","response","quizid","JSON","parse","repaginate_slots","r","load_section_time","questions","querySelectorAll","totaltime","get_total_time_of_questions","sectiontimeunit","get_time_in_unit","call","methodname","args","done","fail","err","console","log","set_section_time","get_section_time_call","warningtimestr","get_section_time","timeunit","warningtime","createElement","append","appendChild","removeChild","text","t","length","parseInt","timeinseconds","load_page_time","page","pagetime","nextUntil","pagetimeunit","create_timed_page_elements","pagevalue","pageunit","pageloadedsections","get_page_time_from_section","includes","push","sectionpages","when","format_pagetime","seconds","minutes","hours","h","Math","floor","m","s","toFixed","sectiontimeinunit","quiztimer","get_quiz_time","stringify","slot","questionid","set_question_time","get_page_from_slotid","load_question_time","prev","init","ready","navitem","select","add","Option","addEventListener","quiztime","slotheader","secrettimetype","pagesar","x","editpen","timeinput","pages","sections"],"mappings":"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"}