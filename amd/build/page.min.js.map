{"version":3,"file":"page.min.js","sources":["../src/page.js"],"sourcesContent":["define(function(require, exports, module) {\n    'use strict';\n\n    var init = function(data) {\n        var attemptid = data.attemptid;\n        var tiempos = data.tiempos;\n\n        const backgroundColors = [\"#ca3120\", \"#d73422\", \"#dd3d2b\", \"#e04938\",\n        \"#e25546\", \"#e46153\", \"#e66d60\", \"#e8796d\", \"#ea867a\", \"#ec9288\",\n        \"#ee9e95\", \"#f0aaa2\", \"#f2b6af\", \"#f4c2bc\", \"#f7ceca\", \"#f9dad7\", \"#fbe6e4\"];\n\n       const textColors = [\"#fff\", \"#fff\", \"#fff\", \"#fff\", \"#fff\", \"#fff\",\n        \"#fff\", \"#1d2125\", \"#1d2125\", \"#1d2125\", \"#1d2125\",\n        \"#1d2125\", \"#1d2125\", \"#1d2125\", \"#1d2125\", \"#1d2125\", \"#1d2125\"];\n\n       //Disable original timer\n       var divElement = document.getElementById(\"quiz-timer\");\n       divElement.disabled = true;\n       divElement.innerHTML = \"Timer disabled\";\n\n       var quizTimerWrapper = document.getElementById(\"quiz-timer-wrapper\");\n       if (quizTimerWrapper.style.display === \"flex\") {\n       quizTimerWrapper.style.display = \"\";\n       }\n\n       var currentPageURL = window.location.href;\n       var urlParams = new URLSearchParams(currentPageURL);\n       var pageID = urlParams.get(\"page\");\n\n       if(pageID === null){\n           pageID = 0;\n       }\n\n       var countdownID = \"countdown\" + pageID;\n       var quiztimercountdown = document.createElement('div');\n       quiztimercountdown.id = countdownID;\n       quiztimercountdown.className = 'countdown-section';\n\n       quiztimercountdown.style.maxWidth = \"max-content\";\n       quiztimercountdown.style.marginLeft = \"auto\";\n\n       var existingDiv = document.querySelector('.container-fluid.tertiary-navigation');\n       existingDiv.parentNode.insertBefore(quiztimercountdown, existingDiv.nextSibling);\n\n       var headingElement = document.querySelectorAll(\".container-fluid.tertiary-navigation\");\n\n       /**\n        * Updates the countdown timer based on the end time.\n        *\n        * @param {number} endTime - The end time of the countdown timer in seconds.\n        */\n       function updateCountdownTimer(endTime) {\n\n           var countdownElement = document.getElementById(\"countdown\" + (pageID));\n           var countdownInterval = setInterval(function() {\n               var currentTime = Math.floor(Date.now() / 1000);\n               var timeRemaining =  (endTime - 1) - currentTime;\n\n               function getColorBackgroundByPercentage(percentage) {\n\n                   var index = percentage / 10;\n\n                   // Devolver el color correspondiente\n                   return backgroundColors[index];\n               }\n               function getColorTextByPercentage(percentage) {\n                   var index = percentage / 10;\n\n                   // Devolver el color correspondiente\n                   return textColors[index];\n               }\n\n\n               // Calcular el porcentaje actual en relación con la duración total\n               var totalDuration = endTime - (endTime - 1);\n               var currentPercentage = (timeRemaining / totalDuration) * 10;\n               countdownElement.style.backgroundColor = getColorBackgroundByPercentage(currentPercentage);\n               countdownElement.style.color = getColorTextByPercentage(currentPercentage);\n\n\n\n\n               if (timeRemaining <= -1 ) {\n                   clearInterval(countdownInterval);\n                   var button = document.getElementById(\"mod_quiz-next-nav\");\n                   localStorage.setItem(\"countdown\" + pageID, 0);\n                   countdownElement.innerHTML = \"00:00:00\";\n                   countdownElement.disabled = true;\n                   button.click();\n                   return;\n               } else {\n                   var button = document.getElementById(\"mod_quiz-next-nav\");\n                   if (button) {\n                       button.addEventListener(\"click\", function() {\n                           localStorage.setItem(\"countdown\" + pageID, timeRemaining);\n                       });\n                   }\n               }\n\n               // Function to save the countdown time before leaving the page\n               function saveCountdownTime() {\n                   var countdownElement = document.getElementById(\"countdown\" + pageID);\n                   localStorage.setItem(\"countdown\" + pageID, timeRemaining);\n                   localStorage.setItem(\"attempt\",  JSON.stringify(attemptid));\n               }\n\n               // Attach the saveCountdownTime function to the beforeunload event\n               window.addEventListener(\"beforeunload\", saveCountdownTime);\n\n               var hours = Math.floor(timeRemaining / 3600);\n               var minutes = Math.floor((timeRemaining % 3600) / 60);\n               var seconds = timeRemaining % 60;\n\n               var formattedTime = hours.toString().padStart(2, \"0\") + \":\" +\n                                   minutes.toString().padStart(2, \"0\") + \":\" +\n                                   seconds.toString().padStart(2, \"0\");\n               countdownElement.innerHTML = formattedTime;\n               }, 1);\n\n       }\n\n\n\n\n       // Get the end time from your server-side variable.\n       var endTime = tiempos[pageID] + Math.floor(Date.now() / 1000);\n\n\n       var storedTime = localStorage.getItem(\"countdown\" + pageID);\n       if (storedTime !== null) {\n           // Use the stored time as the end time\n           endTime = parseInt(storedTime) + Math.floor(Date.now() / 1000);\n           // Remove the stored time from localStorage\n           localStorage.removeItem(\"countdown\" + pageID);\n       }\n\n\n\n       // Start the countdown timer.\n       updateCountdownTimer(endTime + 1,5);\n\n       // Insert countdown elements after the respective heading elements.\n       headingElement.forEach(function(headingElement, index) {\n\n       var textoElement = document.getElementById(\"countdown\" + (index));\n       if (headingElement && textoElement) {\n           //headingElement.parentNode.insertBefore(textoElement, headingElement.nextSibling);\n           headingElement.appendChild(textoElement);\n       }\n        });\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","require","exports","module","init","data","attemptid","tiempos","backgroundColors","textColors","divElement","document","getElementById","disabled","innerHTML","quizTimerWrapper","style","display","currentPageURL","window","location","href","pageID","URLSearchParams","get","countdownID","quiztimercountdown","createElement","id","className","maxWidth","marginLeft","existingDiv","querySelector","parentNode","insertBefore","nextSibling","headingElement","querySelectorAll","endTime","Math","floor","Date","now","storedTime","localStorage","getItem","parseInt","removeItem","countdownElement","countdownInterval","setInterval","currentTime","timeRemaining","currentPercentage","backgroundColor","color","percentage","getColorTextByPercentage","clearInterval","button","setItem","click","addEventListener","JSON","stringify","hours","minutes","seconds","formattedTime","toString","padStart","updateCountdownTimer","forEach","index","textoElement","appendChild"],"mappings":"AAAAA,oCAAO,SAASC,QAASC,QAASC,cAwJvB,CACHC,KAtJO,SAASC,UACZC,UAAYD,KAAKC,UACjBC,QAAUF,KAAKE,cAEbC,iBAAmB,CAAC,UAAW,UAAW,UAAW,UAC3D,UAAW,UAAW,UAAW,UAAW,UAAW,UACvD,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAE7DC,WAAa,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAC3D,OAAQ,UAAW,UAAW,UAAW,UACzC,UAAW,UAAW,UAAW,UAAW,UAAW,eAGpDC,WAAaC,SAASC,eAAe,cACzCF,WAAWG,UAAW,EACtBH,WAAWI,UAAY,qBAEnBC,iBAAmBJ,SAASC,eAAe,sBACR,SAAnCG,iBAAiBC,MAAMC,UAC3BF,iBAAiBC,MAAMC,QAAU,QAG7BC,eAAiBC,OAAOC,SAASC,KAEjCC,OADY,IAAIC,gBAAgBL,gBACbM,IAAI,QAEb,OAAXF,SACCA,OAAS,OAGTG,YAAc,YAAcH,OAC5BI,mBAAqBf,SAASgB,cAAc,OAChDD,mBAAmBE,GAAKH,YACxBC,mBAAmBG,UAAY,oBAE/BH,mBAAmBV,MAAMc,SAAW,cACpCJ,mBAAmBV,MAAMe,WAAa,WAElCC,YAAcrB,SAASsB,cAAc,wCACzCD,YAAYE,WAAWC,aAAaT,mBAAoBM,YAAYI,iBAEhEC,eAAiB1B,SAAS2B,iBAAiB,4CAiF3CC,QAAUhC,QAAQe,QAAUkB,KAAKC,MAAMC,KAAKC,MAAQ,KAGpDC,WAAaC,aAAaC,QAAQ,YAAcxB,QACjC,OAAfsB,aAEAL,QAAUQ,SAASH,YAAcJ,KAAKC,MAAMC,KAAKC,MAAQ,KAEzDE,aAAaG,WAAW,YAAc1B,kBAlFZiB,aAEtBU,iBAAmBtC,SAASC,eAAe,YAAeU,QAC1D4B,kBAAoBC,aAAY,eAC5BC,YAAcZ,KAAKC,MAAMC,KAAKC,MAAQ,KACtCU,cAAkBd,QAAU,EAAKa,gBAmBjCE,kBAAqBD,eADLd,SAAWA,QAAU,IACiB,MAC1DU,iBAAiBjC,MAAMuC,gBAbZ/C,iBAa6D8C,kBAhB3C,IAiB7BL,iBAAiBjC,MAAMwC,eAZWC,mBAIvBhD,WAHKgD,WAAa,IAWEC,CAAyBJ,mBAKpDD,gBAAkB,EAAI,CACtBM,cAAcT,uBACVU,OAASjD,SAASC,eAAe,4BACrCiC,aAAagB,QAAQ,YAAcvC,OAAQ,GAC3C2B,iBAAiBnC,UAAY,WAC7BmC,iBAAiBpC,UAAW,OAC5B+C,OAAOE,SAGHF,OAASjD,SAASC,eAAe,uBAEjCgD,OAAOG,iBAAiB,SAAS,WAC7BlB,aAAagB,QAAQ,YAAcvC,OAAQ+B,kBAavDlC,OAAO4C,iBAAiB,2BANGpD,SAASC,eAAe,YAAcU,QAC7DuB,aAAagB,QAAQ,YAAcvC,OAAQ+B,eAC3CR,aAAagB,QAAQ,UAAYG,KAAKC,UAAU3D,mBAMhD4D,MAAQ1B,KAAKC,MAAMY,cAAgB,MACnCc,QAAU3B,KAAKC,MAAOY,cAAgB,KAAQ,IAC9Ce,QAAUf,cAAgB,GAE1BgB,cAAgBH,MAAMI,WAAWC,SAAS,EAAG,KAAO,IACpCJ,QAAQG,WAAWC,SAAS,EAAG,KAAO,IACtCH,QAAQE,WAAWC,SAAS,EAAG,KACnDtB,iBAAiBnC,UAAYuD,gBAC1B,GAsBXG,CAAqBjC,QAAU,GAG/BF,eAAeoC,SAAQ,SAASpC,eAAgBqC,WAE5CC,aAAehE,SAASC,eAAe,YAAe8D,OACtDrC,gBAAkBsC,cAElBtC,eAAeuC,YAAYD,kBAQrC"}